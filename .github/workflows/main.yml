name: Aqua Security Image Scan (Docker)

on: [push]

jobs:
  aqua_scan:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run Aqua Scanner in Docker
        run: |
          docker run --rm \
            -e AQUA_USERNAME=${{ secrets.AQUA_USERNAME }} \
            -e AQUA_PASSWORD=${{ secrets.AQUA_PASSWORD }} \
            -e REGISTRY_URL=${{ secrets.REGISTRY_URL }} \
            -e IMAGE_NAME=${{ secrets.IMAGE_NAME }} \
            aquasec/scanner:latest scan \
            --username $AQUA_USERNAME \
            --password $AQUA_PASSWORD \
            --registry $REGISTRY_URL \
            --image $IMAGE_NAME
